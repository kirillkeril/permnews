# Policy-based authorization microservice

## Задумка:

Любой **ресурс** имеет **пространство имен**, в котором он находится, и может иметь **мета-атрибуты**,
которые можно назначать каждому ресурсу отдельно (например, *идентификатор*, пока не знаю что еще).

Пользователь имеет **политики** к ресурсам в пространстве имен, которое описано объектом.
Объект содержит **пространство имен**, **действие** (если не указано - допустимы все) и **мета-атрибуты**,
каждый из которых строго атомарное значение. Атрибуты объединены *логическим И*, для доступа к ресурсу
политика должна соответствовать всем определенным ресурсом **мета-атрибутам**.

## Пример

Имеем пространство имен `Books`, и набор ресурсов

```js
Book1 = {
    namespace: "Books",
    meta: {
        "id": 1
    }
}
Book2 = {
    namespace: "Books",
    meta: {
        "id": 2
    }
}
```

Политики

```js
Policy1 = {
    "Namespace": "Books"
}
Policy2 = {
    "Namespace": "Books",
    "Actions": [
        "Read",
    ],
    "meta": {
        "id": 1
    }
}
Policy3 = {
    "Namespace": "Books",
    "Actions": [
        "Read",
        "Write",
    ],
    "meta": {
        "id": 1
    }
}
Policy4 = {
    "Namespace": "Books",
    "Actions": [
        "Read",
    ],
    "meta": {
        "id": 2
    }
}
```

Также имеем пользователей

```js
User1 = {
    "id": 1,
    "name": "First",
    "policies": [
        Policy1
    ]
}
User2 = {
    "id": 2,
    "name": "Second",
    "policies": [
        Policy2
    ]
}
User3 = {
    "id": 3,
    "name": "Third",
    "policies": [
        Policy3,
        Policy4
    ]
}
```

В данном примере:

1. `User1` имеет доступ ко всем ресурсам в пространстве имен `Books`,
   т.к. он имеет политику, не ограничивающую действия и соответствие мета информации,
2. `User2` имеет доступ только на чтение и изменение `Book2`,
   т.к. его политика ограничивает допустимые действия,
3. `User3` имеет доступ на чтение и запись ресурса `Books1` и только чтение ресурса `Books2`,
   т.к. он имеет две политики, одна из которых ограничивает чтение и запись ресурса с `id=1`,
   а вторая - чтение ресурса с `id=2`

## Выполнение
В микросервисной архитектуре каждый сервис может иметь сколько угодно ресурсов, которые описываются 
стандартно представленным способом. Создает политики и назначает их пользователям микросервис авторизации.
Каждый микросервис сам проверяет доступ пользователя к своим ресурсам путем вызова `RPC`, куда передается 
объект ресурса и все политики пользователя.